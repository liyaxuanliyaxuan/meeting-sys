{"version":3,"sources":["constant/index.ts","pages/Login/Msg/Msg.module.scss","pages/Login/Msg/index.tsx"],"names":["verificationWaitTime","module","exports","Msg","useCountDown","count","start","verificationStatus","useState","verificationValue","setVerificationValue","key","useChange","verification","isValidateRight","setIsValidateRight","useImmer","mailOrPhone","msg","warn","isRight","validateMsg","setValidateMsg","history","useHistory","getVerificationCodeR","useRequest","getVerificationCode","manual","useOnUpdate","validateForm","validatePhoneOrMail","validate","required","value","isPhoneNumber","isEmail","draft","validateVerification","validateKey","useDebounceFn","checkValidate","className","style","form","onSubmit","e","preventDefault","push","verificationCode","onInput","run","type","placeholder","bind","hasBtn","btnValue","btnStatus","btnCallback","btn","disabled"],"mappings":"yHAAA,sCAQaA,EAAuB,G,oBCPpCC,EAAOC,QAAU,CAAC,KAAO,kBAAkB,IAAM,mB,4KCiJlCC,UAxHf,YAAwC,qBAEKC,YAAaJ,KAFnB,mBAE9BK,EAF8B,KAEvBC,EAFuB,KAEhBC,EAFgB,OAGaC,mBAAS,kCAHtB,mBAG9BC,EAH8B,KAGXC,EAHW,KAI/BC,EAAMC,YAAU,IAChBC,EAAeD,YAAU,IALM,EAMSJ,oBAAS,GANlB,mBAM9BM,EAN8B,KAMbC,EANa,OAOCC,YAAS,CAC7CC,YAAa,CAAEC,IAAK,iFAAiBC,MAAM,EAAMC,SAAQ,GACzDP,aAAc,CAAEK,IAAK,GAAIC,MAAM,EAAMC,SAAQ,KATV,mBAO9BC,EAP8B,KAOjBC,EAPiB,KAW/BC,EAAUC,cACVC,EAAuBC,YAAWC,IAAqB,CAC3DC,QAAQ,IAEVC,aAAY,WAERnB,GADyB,IAAvBH,EACmB,8CAAD,OAAYF,EAAZ,KAEC,oCAEtB,CAACA,IAGJ,IAQMyB,EAAe,CACnBC,oBAAqB,WACnB,OAAIC,IAASC,SAAStB,EAAIuB,OAEpBF,IAASG,cAAcxB,EAAIuB,QAAUF,IAASI,QAAQzB,EAAIuB,QAC5DZ,GAAe,SAAAe,GACbA,EAAMpB,YAAYC,IAAM,iFACxBmB,EAAMpB,YAAYE,MAAO,EACzBkB,EAAMpB,YAAYG,SAAQ,MAErB,IAEPE,GAAe,SAAAe,GACbA,EAAMpB,YAAYC,IAAM,iFACxBmB,EAAMpB,YAAYE,MAAO,EACzBkB,EAAMpB,YAAYG,SAAQ,MAErB,IAGTE,GAAe,SAAAe,GACbA,EAAMpB,YAAYC,IAAM,+DACxBmB,EAAMpB,YAAYE,MAAO,EACzBkB,EAAMpB,YAAYG,SAAU,MAEvB,IAGXkB,qBAAsB,WAEpB,OAAIN,IAASC,SAASpB,EAAaqB,QACjCZ,GAAe,SAAAe,GACbA,EAAMxB,aAAaK,IAAM,GACzBmB,EAAMxB,aAAaM,MAAO,EAC1BkB,EAAMxB,aAAaO,SAAQ,MAEtB,IAEPE,GAAe,SAAAe,GACbA,EAAMxB,aAAaK,IAAM,6CACzBmB,EAAMxB,aAAaM,MAAO,EAC1BkB,EAAMxB,aAAaO,SAAS,MAEvB,KAIPmB,EAAcC,YAAcV,EAAaC,oBAAqB,KAC9DO,EAAuBE,YAAcV,EAAaQ,qBAAsB,KACxEG,EAAgBD,aAAc,WAC9BnB,EAAYJ,YAAYG,SAAWC,EAAYR,aAAaO,QAC9DL,GAAmB,GAEnBA,GAAmB,KAErB,KAMF,OACE,0BAAM2B,UAAWC,IAAMC,KAAMC,SALV,SAACC,GACpBA,EAAEC,iBACFxB,EAAQyB,KAAK,UAAW,CAAEC,iBAAkBpC,EAAaqB,SAGJgB,QAAST,EAAcU,KAC1E,kBAAC,IAAD,CACEC,KAAK,OACLC,YAAY,kCACZnC,IAAKG,EAAYJ,YAAYC,IAC7BC,KAAME,EAAYJ,YAAYE,KAC9BmC,KAAM3C,EACNuC,QAASX,EAAYY,MAEvB,kBAAC,IAAD,CACEC,KAAK,OACLC,YAAY,uCACZE,QAAQ,EACRC,SAAU/C,EACVgD,UAAWlD,EACXmD,YArF4B,SAACZ,GACjCA,EAAEC,iBACEjB,EAAaC,wBACfzB,IACAmB,EAAqB0B,IAAIxC,EAAIuB,SAkF3BhB,IAAKG,EAAYR,aAAaK,IAC9BC,KAAME,EAAYR,aAAaM,KAC/BmC,KAAMzC,EACNqC,QAASZ,EAAqBa,MAEhC,kBAAC,IAAD,CAAQT,UAAWC,IAAMgB,IAAKC,UAAW9C","file":"static/js/20.6e0f2c68.chunk.js","sourcesContent":["const normal={}\r\n// 会议类型\r\nexport const meetingTypes = {\r\n  studentTeams: 6, //学生组队\r\n  researchTeams:5, // 科研团队\r\n}\r\n\r\n// 验证码需要等待的时间\r\nexport const verificationWaitTime = 5\r\n\r\nexport const uploadFilerUrl ='http://www.ljhhhx.com:8080/meeting-v2/file'\r\n\r\nexport default normal","// extracted by mini-css-extract-plugin\nmodule.exports = {\"form\":\"Msg_form__J-iFi\",\"btn\":\"Msg_btn__3lslh\"};","import React, {\r\n  ReactElement,\r\n  useState,\r\n} from 'react';\r\nimport { useHistory } from 'react-router-dom'\r\n\r\nimport Button from '@/components/login/LoginButton';\r\nimport Input from '@/components/login/LoginInput';\r\nimport {\r\n  useCountDown,\r\n  useOnUpdate,\r\n  useChange\r\n} from '@/hooks';\r\nimport { useRequest,useDebounceFn } from '@umijs/hooks'\r\nimport { getVerificationCode } from '@/services/apis/user'\r\nimport validate from '@/utils/validate'\r\nimport { useImmer } from 'use-immer'\r\nimport {verificationWaitTime} from '@/constant'\r\n\r\n\r\nimport style from './Msg.module.scss';\r\n\r\ninterface Props {\r\n\r\n}\r\n\r\nfunction Msg({ }: Props): ReactElement {\r\n\r\n  const [count, start, verificationStatus] = useCountDown(verificationWaitTime)\r\n  const [verificationValue, setVerificationValue] = useState('获取验证码')\r\n  const key = useChange('')\r\n  const verification = useChange('')\r\n  const [isValidateRight, setIsValidateRight] = useState(false)\r\n  const [validateMsg, setValidateMsg] = useImmer({\r\n    mailOrPhone: { msg: '手机号尽量与微信号保持一致', warn: false,isRight:false },\r\n    verification: { msg: '', warn: false,isRight:false },\r\n  })\r\n  const history = useHistory()\r\n  const getVerificationCodeR = useRequest(getVerificationCode, {\r\n    manual: true,\r\n  })\r\n  useOnUpdate(() => {\r\n    if (verificationStatus === true) {\r\n      setVerificationValue(`重新发送验证码(${count})`)\r\n    } else {\r\n      setVerificationValue('获取验证码')\r\n    }\r\n  }, [count])\r\n\r\n  //获取验证码\r\n  const handleGetVerificationCode = (e: React.SyntheticEvent) => {\r\n    e.preventDefault()\r\n    if (validateForm.validatePhoneOrMail()) {\r\n      start()\r\n      getVerificationCodeR.run(key.value)\r\n    }\r\n  }\r\n\r\n  const validateForm = {\r\n    validatePhoneOrMail: () => {\r\n      if (validate.required(key.value)) {\r\n        // 验证正确格式\r\n        if (validate.isPhoneNumber(key.value) || validate.isEmail(key.value)) {\r\n          setValidateMsg(draft => {\r\n            draft.mailOrPhone.msg = '手机号尽量与微信号保持一致'\r\n            draft.mailOrPhone.warn = false\r\n            draft.mailOrPhone.isRight=true\r\n          })\r\n          return true\r\n        } else {\r\n          setValidateMsg(draft => {\r\n            draft.mailOrPhone.msg = '请输入正确的电话号码或邮箱'\r\n            draft.mailOrPhone.warn = true\r\n            draft.mailOrPhone.isRight=false\r\n          })\r\n          return false\r\n        }\r\n      } else {\r\n        setValidateMsg(draft => {\r\n          draft.mailOrPhone.msg = '邮箱或者电话不能为空'\r\n          draft.mailOrPhone.warn = true\r\n          draft.mailOrPhone.isRight = false\r\n        })\r\n        return false\r\n      }\r\n    },\r\n    validateVerification: () => {\r\n      // 验证验证码是否为空\r\n      if (validate.required(verification.value)) {\r\n        setValidateMsg(draft => {\r\n          draft.verification.msg = ''\r\n          draft.verification.warn = false\r\n          draft.verification.isRight=true\r\n        })\r\n        return true\r\n      } else {\r\n        setValidateMsg(draft => {\r\n          draft.verification.msg = '验证码不能为空'\r\n          draft.verification.warn = true\r\n          draft.verification.isRight =false\r\n        })\r\n        return false\r\n      }\r\n    }\r\n  }\r\n  const validateKey = useDebounceFn(validateForm.validatePhoneOrMail, 300)\r\n  const validateVerification = useDebounceFn(validateForm.validateVerification, 300)\r\n  const checkValidate = useDebounceFn(() => {\r\n    if (validateMsg.mailOrPhone.isRight && validateMsg.verification.isRight) {\r\n      setIsValidateRight(true)\r\n    } else {\r\n      setIsValidateRight(false)\r\n    }\r\n  },300)\r\n  // 登录/注册\r\n  const handleSubmit = (e: React.SyntheticEvent) => {\r\n    e.preventDefault()\r\n    history.push('/signup', { verificationCode: verification.value })\r\n  }\r\n  return (\r\n    <form className={style.form} onSubmit={handleSubmit} onInput={checkValidate.run}>\r\n      <Input\r\n        type='text'\r\n        placeholder='手机号/邮箱'\r\n        msg={validateMsg.mailOrPhone.msg}\r\n        warn={validateMsg.mailOrPhone.warn}\r\n        bind={key}\r\n        onInput={validateKey.run}\r\n      />\r\n      <Input\r\n        type='text'\r\n        placeholder='请输入验证码'\r\n        hasBtn={true}\r\n        btnValue={verificationValue}\r\n        btnStatus={verificationStatus}\r\n        btnCallback={handleGetVerificationCode}\r\n        msg={validateMsg.verification.msg}\r\n        warn={validateMsg.verification.warn}\r\n        bind={verification}\r\n        onInput={validateVerification.run}\r\n      />\r\n      <Button className={style.btn} disabled={!isValidateRight}/>\r\n    </form>\r\n  )\r\n}\r\n\r\nexport default Msg\r\n"],"sourceRoot":""}